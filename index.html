<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brianna Chiu: Motion Designer</title>
<style>
body, html {
    margin: 0;
    font-size: 0px;
    font-family: Arial, sans-serif;
    overflow-x: hidden; /* Prevent horizontal scrolling */
    overflow-y: auto;   /* Allow vertical scrolling */
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #ECECEC;
}
canvas {
    width: 4000px; /* Set canvas width manually */
    margin: 0 auto; /* Center the canvas horizontammmlly */
    display: block; /* Ensure proper centering */
}
</style>
<script src="https://unpkg.com/@rive-app/canvas@latest"></script>
</head>
<body>
<canvas id="riveCanvas"></canvas>
<div id="widthDisplay"></div>
<script>
    let riveInstance, widthNumInput;

    const preloadAllImages = async () => {
        const totalImages = 174; // 0 to 173
        const preloadedImages = [];

        console.log("Starting to preload all images...");




        // Update Rive input if available
        if (widthNumInput) {
            widthNumInput.value = browserWidth;
        }

        // Update canvas height based on breakpoint
        if (browserWidth >= 1500) {
            canvas.style.height = '2205px'; // wide height
        } else {
            canvas.style.height = '3054px'; // skinny height
        }

        // Ensure Rive redraws on canvas resize
        if (riveInstance) {
            riveInstance.resizeDrawingSurfaceToCanvas();
        }
    }

    // function onRiveEventReceived(riveEvent) {
    //     const eventData = riveEvent.data;
    //     if (eventData.type === rive.RiveEventType.OpenUrl) {
    //         console.log("Event triggered:", eventData.name);
    //         console.log("Opening URL:", eventData.url);
            
    //         // Open the URL in a new tab
    //         window.open(eventData.url, "_blank");


    //     }
    // }

    function onRiveEventReceived(riveEvent) {
    const eventData = riveEvent.data;

    if (eventData.type === rive.RiveEventType.OpenUrl) {
        console.log("Event triggered:", eventData.name);

        switch (eventData.name) {
            case "Email":
                console.log("Opening Email");
                window.open("https://mail.google.com/mail/u/0/?fs=1&to=bri.mograph@gmail.com&su=Hi%20Bri!&body=You%27re%20so%20cool%20and%20I%27m%20so%20cool.%20We%20should%20work%20together!&tf=cm", "_blank");
                break;
            case "Resume":
                console.log("Opening Resume");
                window.open("https://drive.google.com/file/d/1Un9slfnD87eTaGfLCBiulZFgyjUqh061/view?usp=drive_link", "_blank");
                break;
            case "Demo-Reel":
                console.log("Navigating to Demo Reel");
                window.location.href = "pages/demo-reel.html";
                break;
            case "contact":
                console.log("Navigating to Contact");
                window.location.href = "/contact.html";
                break;
            case "externalLink":
                console.log("Opening External Link:", eventData.url);
                window.open(eventData.url, "_blank");
                break;
            default:
                console.log("Default action: Opening URL");
                window.open(eventData.url, "_blank");
        }
    }
}



    // Initialize Rive
    riveInstance = new rive.Rive({
        src: 'layouts.riv',
        canvas: document.getElementById('riveCanvas'),
        autoplay: true,
        artboard: 'Site', // Ensure this artboard name is correct
        stateMachines: 'State Machine 1', // Ensure this state machine name is correct
        assetLoader: (asset, bytes) => {
            console.log("Asset loading:", {
                name: asset.name,
                fileExtension: asset.fileExtension,
                cdnUuid: asset.cdnUuid,
                isFont: asset.isFont,
                isImage: asset.isImage,
                bytes,
            });

            if (asset.isImage) {
                if (asset.name === 'profile') {
                    return false;
                }
                
                // Load images in sequence
                let currentIndex = 0;
                const loadNextImage = () => {
                    if (currentIndex <= 173) {
                        // Add repository name to path if using GitHub Pages
                        const baseUrl = window.location.hostname === 'github.io' 
                            ? '/website' // Replace 'your-repo-name' with your actual repository name
                            : '';
                        const imagePath = `${baseUrl}/assets/images/demo-reel-thumbnail/Reel gif_${currentIndex.toString().padStart(5, "00000")}.png`;
                        fetch(imagePath)
                            .then(res => {
                                if (res.ok) return res.arrayBuffer();
                                throw new Error(`Failed to load image ${currentIndex}`);
                            })
                            .then(arrayBuffer => rive.decodeImage(new Uint8Array(arrayBuffer)))
                            .then(image => {
                                asset.setRenderImage(image);
                                image.unref();
                                currentIndex++;
                                loadNextImage(); // Load next image only after current one is set
                            })
                            .catch(err => console.error(`Error with image ${currentIndex}:`, err));
                    }
                };
                
                loadNextImage();
                return true;
            }
            return false;
        },
        onLoad: () => {
            const inputs = riveInstance.stateMachineInputs('State Machine 1'); // Ensure this state machine name is correct
            widthNumInput = inputs.find(i => i.name === 'width num'); // Ensure this input name is correct
            riveInstance.resizeDrawingSurfaceToCanvas();

            // Update canvas height on load and resize
            updateCanvasHeight();
            window.onresize = updateCanvasHeight;
        }
    });

    // Listen for Rive Events
    riveInstance.on(rive.EventType.RiveEvent, onRiveEventReceived);
</script>
</body>
</html>
